<!DOCTYPE html>
<html>
<head>
  <title>Table Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f1f7fa; }
    h1 { margin-bottom: 10px; }
    button { padding: 10px 20px; margin: 5px; font-size: 16px; border-radius: 10px; border: none; background-color: #3498db; color: white; cursor: pointer; }
    button:hover { background-color: #2980b9; }
    .status-box { margin-top: 20px; font-size: 18px; }
    .revisited { color: green; font-weight: bold; }
    .new { color: red; font-weight: bold; }
    #zoneList { list-style: none; padding: 0; margin-top: 20px; }
    li { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>ğŸ“ Table Tracker (Geofence)</h1>
  <p>Mark table locations using GPS. The app will detect which table you're at.</p>
  
  <button onclick="markTable(1)">ğŸ“Œ Mark Table 1</button>
  <button onclick="markTable(2)">ğŸ“Œ Mark Table 2</button>
  
  <div class="status-box" id="status">Status: Waiting for GPS...</div>
  <ul id="zoneList"></ul>

  <script>
    let currentPosition = null;

    function toRadians(degrees) {
      return degrees * Math.PI / 180;
    }

    function haversine(lat1, lon1, lat2, lon2) {
      const R = 6371e3; // metres
      const Ï†1 = toRadians(lat1);
      const Ï†2 = toRadians(lat2);
      const Î”Ï† = toRadians(lat2 - lat1);
      const Î”Î» = toRadians(lon2 - lon1);

      const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
                Math.cos(Ï†1) * Math.cos(Ï†2) *
                Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

      const d = R * c; // in metres
      return d;
    }

    function markTable(tableNumber) {
      if (!currentPosition) {
        alert("Waiting for GPS fix...");
        return;
      }
      const key = `table_${tableNumber}`;
      const tableData = {
        lat: currentPosition.lat,
        lon: currentPosition.lon,
        time: new Date().toLocaleString()
      };
      localStorage.setItem(key, JSON.stringify(tableData));
      alert(`âœ… Table ${tableNumber} location saved.`);
      displayTables();
    }

    function displayTables() {
      const list = document.getElementById("zoneList");
      list.innerHTML = "";
      for (let i = 1; i <= 10; i++) {
        const zone = localStorage.getItem(`table_${i}`);
        if (zone) {
          const z = JSON.parse(zone);
          list.innerHTML += `<li>ğŸ“ Table ${i}: ${z.lat.toFixed(6)}, ${z.lon.toFixed(6)}<br>ğŸ•’ ${z.time}</li>`;
        }
      }
    }

    function checkZones() {
      if (!currentPosition) {
        document.getElementById("status").innerText = "Status: No GPS.";
        return;
      }

      for (let i = 1; i <= 10; i++) {
        const zone = localStorage.getItem(`table_${i}`);
        if (zone) {
          const z = JSON.parse(zone);
          const dist = haversine(currentPosition.lat, currentPosition.lon, z.lat, z.lon);
          if (dist <= 0.5) {
            document.getElementById("status").innerHTML = `<span class="revisited">âœ… You are at Table ${i}</span>`;
            return;
          }
        }
      }
      document.getElementById("status").innerHTML = `<span class="new">ğŸ†• Not near any table</span>`;
    }

    function startTracking() {
      if (!navigator.geolocation) {
        alert("Geolocation is not supported by your browser.");
        return;
      }

      navigator.geolocation.watchPosition(
        (position) => {
          currentPosition = {
            lat: position.coords.latitude,
            lon: position.coords.longitude
          };
          checkZones();
        },
        (error) => {
          document.getElementById("status").innerText = "Error getting location.";
          console.error(error);
        },
        {
          enableHighAccuracy: true,
          maximumAge: 1000,
          timeout: 10000
        }
      );
    }

    startTracking();
    displayTables();
  </script>
</body>
</html>
